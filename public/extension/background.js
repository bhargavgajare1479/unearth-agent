(()=>{const e="http://127.0.0.1:9002/api/analyze";chrome.runtime.onMessage.addListener((t,a,n)=>"analyzeContent"===t.action?(async function(t,a){try{const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!n.ok){const e=await n.text();throw new Error(`Analysis request failed with status: ${n.status}. Body: ${e}`)}a({success:!0,results:await n.json()})}catch(e){console.error("Unearth Agent: Analysis failed",e),a({success:!1,error:e.message})}}(t,n),!0):"translate"===t.action?(fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"translate",...t.payload})}).then(e=>e.json()).then(e=>n(e)).catch(e=>n({success:!1,error:e.message})),!0):"fetchMedia"===t.action?(async function(e,t){try{const{url:a}=e.payload||{};if(!a)throw new Error("No url provided");console.debug("Unearth Agent background: fetchMedia for",a);const n=await fetch(a,{credentials:"include"});if(!n.ok){const e=await n.text();throw new Error(`Failed to fetch media: ${n.status} ${e}`)}const o=n.headers.get("content-type")||"application/octet-stream",s=await n.arrayBuffer(),r=new Uint8Array(s);let c="";const i=32768;for(let e=0;e<r.length;e+=i){const t=r.subarray(e,e+i);c+=String.fromCharCode.apply(null,t)}const d=`data:${o};base64,${btoa(c)}`;console.debug("Unearth Agent background: fetchMedia success:",o,"size",r.length),t({success:!0,dataUri:d,contentType:o})}catch(e){console.error("fetchMedia failed",e),t({success:!1,error:e.message})}}(t,n),!0):void 0),console.log("Unearth Agent background script loaded.")})();
//# sourceMappingURL=background.js.map