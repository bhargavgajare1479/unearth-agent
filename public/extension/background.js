(()=>{const e="http://127.0.0.1:9002/api/analyze";chrome.runtime.onMessage.addListener((t,a,o)=>"analyzeContent"===t.action?(async function(t,a){try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload)});if(!o.ok){const e=await o.text();throw new Error(`Analysis request failed with status: ${o.status}. Body: ${e}`)}a({success:!0,results:await o.json()})}catch(e){console.error("Unearth Agent: Analysis failed",e),a({success:!1,error:e.message})}}(t,o),!0):"translate"===t.action?(fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"translate",...t.payload})}).then(e=>e.json()).then(e=>o(e)).catch(e=>o({success:!1,error:e.message})),!0):"vote"===t.action?(fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"vote",...t.payload})}).then(e=>e.json()).then(e=>o(e)).catch(e=>o({success:!1,error:e.message})),!0):"fetchMedia"===t.action?(async function(e,t){try{const{url:a}=e.payload||{};if(!a)throw new Error("No url provided");console.debug("Unearth Agent background: fetchMedia for",a);const o=await fetch(a,{credentials:"include"});if(!o.ok){const e=await o.text();throw new Error(`Failed to fetch media: ${o.status} ${e}`)}const n=o.headers.get("content-type")||"application/octet-stream",s=await o.arrayBuffer(),r=new Uint8Array(s);let c="";const i=32768;for(let e=0;e<r.length;e+=i){const t=r.subarray(e,e+i);c+=String.fromCharCode.apply(null,t)}const d=`data:${n};base64,${btoa(c)}`;console.debug("Unearth Agent background: fetchMedia success:",n,"size",r.length),t({success:!0,dataUri:d,contentType:n})}catch(e){console.error("fetchMedia failed",e),t({success:!1,error:e.message})}}(t,o),!0):void 0),console.log("Unearth Agent background script loaded.")})();
//# sourceMappingURL=background.js.map