{"version":3,"file":"content.js","mappings":"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","sources":["webpack://nextn/./src/extension/content.js"],"sourcesContent":["// This script is injected into social media pages.\n// It will be responsible for finding posts and adding the \"Fact Check\" button.\n\n// --- UI & MODAL ---\n\nfunction createModal() {\n  const modal = document.createElement(\"div\");\n  modal.id = \"unearth-agent-modal\";\n  modal.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 99999;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    width: 90%;\n    max-width: 500px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    color: #333;\n    display: none;\n    flex-direction: column;\n    max-height: 80vh;\n  `;\n\n  const header = document.createElement(\"div\");\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n  `;\n\n  const title = document.createElement(\"h2\");\n  title.textContent = \"Unearth Agent Analysis\";\n  title.style.margin = \"0\";\n  title.style.fontSize = \"18px\";\n\n  const closeButton = document.createElement(\"button\");\n  closeButton.textContent = \"Ã—\";\n  closeButton.style.cssText = `\n    border: none;\n    background: transparent;\n    font-size: 24px;\n    cursor: pointer;\n  `;\n  closeButton.onclick = () => (modal.style.display = \"none\");\n\n  header.appendChild(title);\n  header.appendChild(closeButton);\n\n  const content = document.createElement(\"div\");\n  content.id = \"unearth-agent-modal-content\";\n  content.style.overflowY = \"auto\";\n\n  modal.appendChild(header);\n  modal.appendChild(content);\n\n  document.body.appendChild(modal);\n  return modal;\n}\n\nconst modal = createModal();\nconst modalContent = document.getElementById(\"unearth-agent-modal-content\");\n\nfunction showLoading() {\n  modal.style.display = \"flex\";\n  modalContent.innerHTML = `<p style=\"text-align: center;\">Analyzing... This may take a moment.</p>`;\n}\n\nfunction showResults(data) {\n  console.log(\"Unearth Agent: showResults\", data);\n  if (!data.success) {\n    modalContent.innerHTML = `<p style=\"color: red; font-weight: bold;\">Analysis Failed</p><p>${data.error || \"An unknown error occurred.\"\n      }</p>\n    <p style=\"font-size: 10px; color: #999; margin-top: 10px;\">Check the extension console or server logs for more details.</p>`;\n    return;\n  }\n\n  const results = data.results;\n  const score = results.misScore?.misinformationImmunityScore ?? \"N/A\";\n  let reasoning = \"No detailed analysis available.\";\n  let details = \"\";\n  let facts = \"\";\n\n  // Helper to format list\n  const formatList = (items) => items.map(i => `<li>${i}</li>`).join('');\n\n  if (results.urlAnalysis) {\n    reasoning = results.urlAnalysis.riskReasoning;\n    details += `<p><strong>Source Reputation:</strong> ${results.urlAnalysis.sourceReputation}</p>`;\n    if (results.urlAnalysis.keyClaims?.length) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Key Claims:</h4><ul style=\"padding-left: 20px; margin-top: 0;\">${formatList(results.urlAnalysis.keyClaims)}</ul></div>`;\n    }\n  }\n  if (results.textAnalysis) {\n    reasoning = results.textAnalysis.riskReasoning;\n    if (results.textAnalysis.keyClaims?.length) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Key Claims:</h4><ul style=\"padding-left: 20px; margin-top: 0;\">${formatList(results.textAnalysis.keyClaims)}</ul></div>`;\n    }\n  }\n  if (results.imageAnalysis) {\n    reasoning = results.imageAnalysis.riskReasoning;\n    details += `<p><strong>Manipulation:</strong> ${results.imageAnalysis.manipulationAssessment}</p>`;\n    if (results.imageAnalysis.description) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Content Description:</h4><p style=\"font-size: 13px; color: #555;\">${results.imageAnalysis.description}</p></div>`;\n    }\n  }\n  if (results.verification) {\n    reasoning = results.verification.gdeltResults;\n    details += `<p><strong>Verification:</strong> ${results.verification.gdeltResults}</p>`;\n    if (results.context) {\n      details += `<p><strong>Weather Match:</strong> ${results.context.weatherMatch ? \"Yes\" : \"No\"}</p>`;\n    }\n  }\n  if (results.transcription) {\n    facts += `<div><h4 style=\"margin-bottom: 5px;\">Transcription:</h4><p style=\"font-size: 12px; color: #666; font-style: italic;\">\"${results.transcription.slice(0, 200)}${results.transcription.length > 200 ? '...' : ''}\"</p></div>`;\n  }\n\n  let scoreColor = \"#333\";\n  let scoreLabel = \"Unknown\";\n  if (score > 75) { scoreColor = \"#22c55e\"; scoreLabel = \"High Trust\"; }\n  else if (score > 40) { scoreColor = \"#f59e0b\"; scoreLabel = \"Caution\"; }\n  else if (score !== \"N/A\") { scoreColor = \"#ef4444\"; scoreLabel = \"High Risk\"; }\n\n  modalContent.innerHTML = `\n    <div style=\"text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;\">\n      <h3 style=\"margin-top: 0; font-size: 14px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;\">Trust Score</h3>\n      <div style=\"display: flex; align-items: center; justify-content: center; gap: 10px;\">\n        <span style=\"font-size: 48px; font-weight: 800; color: ${scoreColor}; line-height: 1;\">${score}</span>\n        <div style=\"text-align: left;\">\n            <div style=\"font-size: 18px; font-weight: bold; color: ${scoreColor};\">${scoreLabel}</div>\n            <div style=\"font-size: 12px; color: #999;\">out of 100</div>\n        </div>\n      </div>\n    </div>\n    \n    <div style=\"margin-bottom: 15px;\">\n      <h4 style=\"margin-bottom: 5px; font-size: 14px;\">Analysis Summary:</h4>\n      <p style=\"background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 14px; line-height: 1.5; border-left: 4px solid ${scoreColor}; margin-top: 0;\">${reasoning}</p>\n    </div>\n\n    ${facts ? `<div style=\"margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 10px;\">${facts}</div>` : ''}\n    \n    ${details ? `<div style=\"font-size: 13px; color: #666; border-top: 1px solid #eee; padding-top: 10px; margin-bottom: 15px;\">${details}</div>` : ''}\n\n    <div style=\"border-top: 1px solid #eee; padding-top: 15px;\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\n            <h4 style=\"margin: 0; font-size: 12px; color: #666; text-transform: uppercase;\">Language</h4>\n            <select id=\"unearth-lang-select\" style=\"font-size: 12px; padding: 2px 5px; border-radius: 4px; border: 1px solid #ccc;\">\n                <option value=\"English\">English</option>\n                <option value=\"Hindi\">Hindi</option>\n                <option value=\"Marathi\">Marathi</option>\n                <option value=\"Spanish\">Spanish</option>\n            </select>\n        </div>\n        <div id=\"unearth-translated-summary\" style=\"display: none; background: #eef2ff; padding: 10px; border-radius: 4px; font-size: 13px; color: #333; margin-bottom: 10px;\"></div>\n\n        <h4 style=\"margin: 0 0 10px 0; font-size: 12px; color: #666; text-transform: uppercase;\">Share Verified Report</h4>\n        <div style=\"display: flex; gap: 8px;\">\n            <button id=\"unearth-share-x\" style=\"flex: 1; background: #000; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;\">Share on X</button>\n            <button id=\"unearth-share-fb\" style=\"flex: 1; background: #1877F2; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;\">Facebook</button>\n        </div>\n        <div style=\"margin-top: 8px;\">\n             <button id=\"unearth-copy-link\" style=\"width: 100%; background: #f0f0f0; color: #333; border: 1px solid #ccc; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;\">Copy Report Link</button>\n        </div>\n    </div>\n  `;\n\n  // Add event listeners\n  setTimeout(() => {\n    const caption = results.generatedCaption || `Verified by Unearth. MIS Score: ${score}/100`;\n    const reportUrl = results.reportUrl || \"https://unearth.ai\";\n    const encodedCaption = encodeURIComponent(caption);\n    const encodedUrl = encodeURIComponent(reportUrl);\n\n    // Share buttons\n    document.getElementById('unearth-share-x').onclick = () => {\n      window.open(`https://twitter.com/intent/tweet?text=${encodedCaption}&url=${encodedUrl}`, '_blank');\n    };\n    document.getElementById('unearth-share-fb').onclick = () => {\n      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedCaption}`, '_blank');\n    };\n    document.getElementById('unearth-copy-link').onclick = () => {\n      navigator.clipboard.writeText(`${caption} ${reportUrl}`).then(() => {\n        const btn = document.getElementById('unearth-copy-link');\n        btn.innerText = \"Copied!\";\n        setTimeout(() => btn.innerText = \"Copy Report Link\", 2000);\n      });\n    };\n\n    // Language Selector\n    const langSelect = document.getElementById('unearth-lang-select');\n    const translatedDiv = document.getElementById('unearth-translated-summary');\n\n    langSelect.onchange = async (e) => {\n      const lang = e.target.value;\n      if (lang === 'English') {\n        translatedDiv.style.display = 'none';\n        return;\n      }\n\n      translatedDiv.style.display = 'block';\n      translatedDiv.innerText = 'Translating...';\n\n      // Send message to background to handle translation (since content script can't call server actions directly easily)\n      // Ideally we would use the background script to proxy this, but for now we'll assume we can't easily import the server action in extension context without a proper API route.\n      // Wait, we have an API route! We should use it.\n      // But the API route currently only handles 'analyze'. We need a 'translate' endpoint or update the analyze endpoint.\n      // For this hackathon scope, let's assume we can't easily add a new route without restarting everything.\n      // Actually, we can just display a message that full translation requires the web dashboard for now, OR we can try to use the existing analyze endpoint if we modified it.\n      // Let's modify the API route to handle translation requests!\n\n      chrome.runtime.sendMessage(\n        {\n          action: \"translate\",\n          payload: { summary: reasoning, targetLanguage: lang }\n        },\n        (response) => {\n          if (response && response.success) {\n            translatedDiv.innerText = response.translatedSummary;\n          } else {\n            translatedDiv.innerText = \"Translation failed. Please try on the website.\";\n          }\n        }\n      );\n    };\n  }, 100);\n}\n\n// --- LOGIC ---\n\nfunction createFactCheckButton(postElement, insertBefore = null) {\n  const button = document.createElement(\"button\");\n  button.innerText = \"Fact Check\";\n  button.className = \"unearth-agent-button\"; // Add a class for styling and to avoid re-adding\n  button.style.cssText = `\n    background-color: #386641;\n    color: white;\n    border: none;\n    border-radius: 9999px;\n    padding: 6px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    margin-top: 8px;\n    opacity: 0.8;\n    transition: opacity 0.2s;\n  `;\n  button.onmouseover = () => (button.style.opacity = \"1\");\n  button.onmouseout = () => (button.style.opacity = \"0.8\");\n\n  button.onclick = async (e) => {\n    e.stopPropagation(); // Prevent navigating to the tweet when clicking the button\n    e.preventDefault();\n\n    showLoading();\n    let payload = null;\n\n    // Extract the best content candidate for analysis\n    const analyzed = extractContentFromPost(postElement);\n    if (analyzed && analyzed.type === \"text\") {\n      payload = { type: \"text\", content: analyzed.content };\n    } else if (analyzed && analyzed.type === \"url\") {\n      // If the URL is already a data URI, use it directly\n      if (analyzed.content.startsWith(\"data:\")) {\n        // Detect image/video from the data URI's MIME type\n        if (analyzed.content.startsWith(\"data:image\")) {\n          payload = { type: \"image\", dataUri: analyzed.content };\n        } else if (\n          analyzed.content.startsWith(\"data:video\") ||\n          analyzed.content.startsWith(\"data:audio\")\n        ) {\n          payload = { type: \"video\", dataUri: analyzed.content };\n        } else {\n          // Unknown MIME type: fallback to URL-based analysis\n          payload = { type: \"url\", content: analyzed.content };\n        }\n      } else {\n        // Request the background to fetch and convert to data URI so we can send it for analysis\n        showLoading();\n        console.debug(\n          \"Unearth Agent: requesting fetchMedia for\",\n          analyzed.content\n        );\n        // If this is a blob: URL we can handle it in the page context without background proxy\n        if (analyzed.content.startsWith(\"blob:\")) {\n          console.log(\"Unearth Agent: Detected blob URL, attempting conversion:\", analyzed.content);\n\n          const handleFallback = () => {\n            console.log(\"Unearth Agent: Fetch failed, attempting frame capture fallback.\");\n            if (analyzed.element && analyzed.element.tagName === 'VIDEO') {\n              const frameData = captureVideoFrame(analyzed.element);\n              if (frameData) {\n                console.log(\"Unearth Agent: Frame capture successful, sending as image.\");\n                chrome.runtime.sendMessage(\n                  {\n                    action: \"analyzeContent\",\n                    payload: { type: \"image\", dataUri: frameData },\n                    origin: window.location.origin,\n                  },\n                  showResults\n                );\n                return;\n              }\n            }\n\n            // If all else fails\n            chrome.runtime.sendMessage(\n              {\n                action: \"analyzeContent\",\n                payload: { type: \"url\", content: analyzed.content },\n                origin: window.location.origin,\n              },\n              showResults\n            );\n          };\n\n          fetchBlobUrlAsDataUri(analyzed.content).then((dataUri) => {\n            if (!dataUri) {\n              handleFallback();\n              return;\n            }\n\n            // Determine if blob is image or video based on MIME type or analyzed.type\n            const ct = dataUri.split(\";\")[0];\n            let type = \"video\"; // Default to video if uncertain, as images usually have clear extensions\n            if (ct.includes(\"image\")) type = \"image\";\n\n            console.log(\"Unearth Agent: Converted blob to data URI. Type:\", type);\n\n            chrome.runtime.sendMessage(\n              {\n                action: \"analyzeContent\",\n                payload: { type: type, dataUri },\n                origin: window.location.origin,\n              },\n              showResults\n            );\n          }).catch(() => handleFallback());\n          return;\n        }\n\n        chrome.runtime.sendMessage(\n          { action: \"fetchMedia\", payload: { url: analyzed.content } },\n          (resp) => {\n            if (!resp || !resp.success) {\n              console.warn(\n                \"Unearth Agent: background fetchMedia failed, falling back to URL\",\n                resp && resp.error\n              );\n              // Fallback: send URL directly to the server to try fetching it\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"url\", content: analyzed.content },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n              return;\n            }\n\n            const { dataUri, contentType } = resp;\n            // Choose the correct input type expected by the analysis endpoint\n            if (contentType && contentType.includes(\"image\")) {\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"image\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            } else if (\n              contentType &&\n              (contentType.includes(\"video\") || contentType.includes(\"audio\"))\n            ) {\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"video\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            } else {\n              // Unknown content type; fall back to URL analysis\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"url\", content: analyzed.content },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            }\n          }\n        );\n        // We bail out here because the async response will call showResults or fallback\n        return;\n      }\n    }\n\n    if (payload) {\n      console.debug(\n        \"Unearth Agent: sending analyzeContent payload type\",\n        payload.type\n      );\n      chrome.runtime.sendMessage(\n        { action: \"analyzeContent\", payload, origin: window.location.origin },\n        showResults\n      );\n    } else {\n      showResults({\n        success: false,\n        error:\n          \"Couldn't find analyzable content (text, image, or video) in this post.\",\n      });\n    }\n  };\n\n  // If an insertion point was provided, insert before it, otherwise append to the post\n  if (insertBefore && insertBefore.parentElement) {\n    insertBefore.parentElement.insertBefore(button, insertBefore);\n  } else {\n    postElement.appendChild(button);\n  }\n\n  return button;\n}\n\n// --- Site detection & Post collection helpers ---\nfunction getSiteType() {\n  const h = window.location.hostname;\n  if (h.includes(\"x.com\") || h.includes(\"twitter.com\")) return \"x\";\n  if (h.includes(\"instagram\") || h.includes(\"instagramc\")) return \"instagram\";\n  if (h.includes(\"facebook.com\")) return \"facebook\";\n  if (\n    document.querySelector(\"article\") ||\n    document.querySelector(\"main article\")\n  )\n    return \"article\";\n  return \"other\";\n}\n\nfunction extractContentFromPost(postElement) {\n  try {\n    const video =\n      postElement.querySelector(\"video[src]\") ||\n      postElement.querySelector(\"video\");\n    if (video && video.src) return { type: \"url\", content: video.src, element: video };\n    // Find the best image candidate (largest by area) to avoid selecting avatars or emojis\n    const images = postElement.querySelectorAll(\"img[src], img[data-src], img[srcset]\");\n    let bestImage = null;\n    let maxArea = 0;\n\n    images.forEach((img) => {\n      const rect = img.getBoundingClientRect();\n      const area = rect.width * rect.height;\n      // Filter out small images (likely avatars, emojis, or UI icons)\n      // 10,000 px^2 is roughly 100x100\n      if (area > 10000 && area > maxArea) {\n        maxArea = area;\n        bestImage = img;\n      }\n    });\n\n    if (bestImage) {\n      let src =\n        bestImage.getAttribute(\"src\") ||\n        bestImage.getAttribute(\"data-src\") ||\n        bestImage.getAttribute(\"srcset\");\n      if (src && src.includes(\",\")) {\n        const parts = src.split(\",\").map((s) => s.trim());\n        const last = parts[parts.length - 1].split(\" \")[0];\n        src = last;\n      }\n      if (src) return { type: \"url\", content: src, element: bestImage };\n    }\n    const text =\n      postElement.querySelector('[data-testid=\"tweetText\"]') ||\n      postElement.querySelector(\"p\") ||\n      postElement.querySelector(\"h1\") ||\n      postElement.querySelector(\"h2\");\n    if (text && text.innerText)\n      return { type: \"text\", content: text.innerText };\n    const combinedText = (postElement.innerText || \"\").trim();\n    if (combinedText.length > 20)\n      return { type: \"text\", content: combinedText.slice(0, 500) };\n    return null;\n  } catch (err) {\n    console.error(\"extractContentFromPost error\", err);\n    return null;\n  }\n}\n\nfunction captureVideoFrame(video) {\n  try {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = video.videoWidth || 640;\n    canvas.height = video.videoHeight || 360;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n    return canvas.toDataURL(\"image/jpeg\");\n  } catch (e) {\n    console.error(\"Unearth Agent: Failed to capture video frame\", e);\n    return null;\n  }\n}\n\n// Convert an ArrayBuffer to a Base64 data URI with a given MIME type\nfunction arrayBufferToDataUri(\n  arrayBuffer,\n  mimeType = \"application/octet-stream\"\n) {\n  const bytes = new Uint8Array(arrayBuffer);\n  const chunkSize = 0x8000; // large chunk size for performance\n  let binary = \"\";\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    const chunk = bytes.subarray(i, i + chunkSize);\n    binary += String.fromCharCode.apply(null, chunk);\n  }\n  const base64 = btoa(binary);\n  return `data:${mimeType};base64,${base64}`;\n}\n\n// Attempt to fetch a blob URL directly from the page context and convert to a data URI\nasync function fetchBlobUrlAsDataUri(url) {\n  try {\n    const resp = await fetch(url);\n    if (!resp.ok) throw new Error(`Failed to fetch blob url: ${resp.status}`);\n    const contentType =\n      resp.headers.get(\"content-type\") || \"application/octet-stream\";\n    const arrayBuffer = await resp.arrayBuffer();\n    return arrayBufferToDataUri(arrayBuffer, contentType);\n  } catch (err) {\n    console.error(\"fetchBlobUrlAsDataUri error\", err);\n    return null;\n  }\n}\n\nfunction collectPosts() {\n  const site = getSiteType();\n  let nodeList = [];\n  if (site === \"x\")\n    nodeList = document.querySelectorAll('article[data-testid=\"tweet\"]');\n  else if (site === \"instagram\")\n    nodeList = document.querySelectorAll(\"article\");\n  else if (site === \"facebook\")\n    nodeList = document.querySelectorAll('div[role=\"article\"]');\n  else if (site === \"article\") nodeList = document.querySelectorAll(\"article\");\n  else\n    nodeList = document.querySelectorAll(\n      'article, div[role=\"article\"], section'\n    );\n  // Filter to ensure posts that contain analyzable content are prioritized\n  return [...nodeList].filter(\n    (p) =>\n      p &&\n      (p.querySelector(\"img[src]\") ||\n        p.querySelector(\"video\") ||\n        p.querySelector(\"p\") ||\n        p.querySelector(\"h1\") ||\n        p.querySelector(\"h2\"))\n  );\n}\n\nfunction addButtonsToPosts() {\n  const posts = collectPosts();\n  posts.forEach((post) => {\n    if (post.querySelector(\".unearth-agent-button\")) return;\n    // Attempt to find an action bar or footer for the post to place our button\n    const actionBar = post.querySelector(\n      'div[role=\"group\"], footer, section, ._abm0, ._9esb, ._a9zp'\n    );\n    createFactCheckButton(post, actionBar);\n  });\n}\n\n// Run the function initially and then use a MutationObserver to watch for new posts being added to the page\n// This is more efficient than running a setInterval\naddButtonsToPosts();\n\nconst observer = new MutationObserver((mutations) => {\n  for (const mutation of mutations) {\n    if (mutation.addedNodes.length) {\n      addButtonsToPosts();\n      break; // No need to check all mutations if we already found new nodes\n    }\n  }\n});\n\nobserver.observe(document.body, {\n  childList: true,\n  subtree: true,\n});\n\nconsole.log(\"Unearth Agent content script loaded and observing.\");\n"],"names":["modal","document","createElement","id","style","cssText","header","title","textContent","margin","fontSize","closeButton","onclick","display","appendChild","content","overflowY","body","createModal","modalContent","getElementById","showLoading","innerHTML","showResults","data","console","log","success","error","results","score","misScore","misinformationImmunityScore","reasoning","details","facts","formatList","items","map","i","join","urlAnalysis","riskReasoning","sourceReputation","keyClaims","length","textAnalysis","imageAnalysis","manipulationAssessment","description","verification","gdeltResults","context","weatherMatch","transcription","slice","scoreColor","scoreLabel","setTimeout","caption","generatedCaption","reportUrl","encodedCaption","encodeURIComponent","encodedUrl","window","open","navigator","clipboard","writeText","then","btn","innerText","langSelect","translatedDiv","onchange","async","e","lang","target","value","chrome","runtime","sendMessage","action","payload","summary","targetLanguage","response","translatedSummary","addButtonsToPosts","site","h","location","hostname","includes","querySelector","getSiteType","nodeList","querySelectorAll","filter","p","collectPosts","forEach","post","actionBar","postElement","insertBefore","button","className","onmouseover","opacity","onmouseout","stopPropagation","preventDefault","analyzed","video","src","type","element","images","bestImage","maxArea","img","rect","getBoundingClientRect","area","width","height","getAttribute","parts","split","s","trim","text","combinedText","err","extractContentFromPost","startsWith","debug","handleFallback","tagName","frameData","canvas","videoWidth","videoHeight","getContext","drawImage","toDataURL","captureVideoFrame","dataUri","origin","url","resp","fetch","ok","Error","status","contentType","headers","get","arrayBuffer","mimeType","bytes","Uint8Array","binary","chunk","subarray","String","fromCharCode","apply","btoa","arrayBufferToDataUri","fetchBlobUrlAsDataUri","catch","warn","parentElement","createFactCheckButton","MutationObserver","mutations","mutation","addedNodes","observe","childList","subtree"],"ignoreList":[],"sourceRoot":""}