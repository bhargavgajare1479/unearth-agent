{"version":3,"file":"content.js","mappings":"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","sources":["webpack://nextn/./src/extension/content.js"],"sourcesContent":["// This script is injected into social media pages.\n// It will be responsible for finding posts and adding the \"Fact Check\" button.\n\n// --- UI & MODAL ---\n\nfunction createModal() {\n  const modal = document.createElement(\"div\");\n  modal.id = \"unearth-agent-modal\";\n  modal.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 99999;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    width: 90%;\n    max-width: 500px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    color: #333;\n    display: none;\n    flex-direction: column;\n    max-height: 80vh;\n  `;\n\n  const header = document.createElement(\"div\");\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n  `;\n\n  const title = document.createElement(\"h2\");\n  title.textContent = \"Unearth Agent Analysis\";\n  title.style.margin = \"0\";\n  title.style.fontSize = \"18px\";\n\n  const closeButton = document.createElement(\"button\");\n  closeButton.textContent = \"Ã—\";\n  closeButton.style.cssText = `\n    border: none;\n    background: transparent;\n    font-size: 24px;\n    cursor: pointer;\n  `;\n  closeButton.onclick = () => (modal.style.display = \"none\");\n\n  header.appendChild(title);\n  header.appendChild(closeButton);\n\n  const content = document.createElement(\"div\");\n  content.id = \"unearth-agent-modal-content\";\n  content.style.overflowY = \"auto\";\n\n  modal.appendChild(header);\n  modal.appendChild(content);\n\n  document.body.appendChild(modal);\n  return modal;\n}\n\nconst modal = createModal();\nconst modalContent = document.getElementById(\"unearth-agent-modal-content\");\n\nfunction showLoading() {\n  modal.style.display = \"flex\";\n  modalContent.innerHTML = `<p style=\"text-align: center;\">Analyzing... This may take a moment.</p>`;\n}\n\nfunction showResults(data) {\n  console.log(\"Unearth Agent: showResults\", data);\n  if (!data.success) {\n    modalContent.innerHTML = `<p style=\"color: red; font-weight: bold;\">Analysis Failed</p><p>${data.error || \"An unknown error occurred.\"\n      }</p>\n    <p style=\"font-size: 10px; color: #999; margin-top: 10px;\">Check the extension console or server logs for more details.</p>`;\n    return;\n  }\n\n  const results = data.results;\n  const score = results.misScore?.misinformationImmunityScore ?? \"N/A\";\n  let reasoning = \"No detailed analysis available.\";\n  let details = \"\";\n  let facts = \"\";\n\n  // Helper to format list\n  const formatList = (items) => items.map(i => `<li>${i}</li>`).join('');\n\n  if (results.urlAnalysis) {\n    reasoning = results.urlAnalysis.riskReasoning;\n    details += `<p><strong>Source Reputation:</strong> ${results.urlAnalysis.sourceReputation}</p>`;\n    if (results.urlAnalysis.keyClaims?.length) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Key Claims:</h4><ul style=\"padding-left: 20px; margin-top: 0;\">${formatList(results.urlAnalysis.keyClaims)}</ul></div>`;\n    }\n  }\n  if (results.textAnalysis) {\n    reasoning = results.textAnalysis.riskReasoning;\n    if (results.textAnalysis.keyClaims?.length) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Key Claims:</h4><ul style=\"padding-left: 20px; margin-top: 0;\">${formatList(results.textAnalysis.keyClaims)}</ul></div>`;\n    }\n  }\n  if (results.imageAnalysis) {\n    reasoning = results.imageAnalysis.riskReasoning;\n    details += `<p><strong>Manipulation:</strong> ${results.imageAnalysis.manipulationAssessment}</p>`;\n    if (results.imageAnalysis.description) {\n      facts = `<div><h4 style=\"margin-bottom: 5px;\">Content Description:</h4><p style=\"font-size: 13px; color: #555;\">${results.imageAnalysis.description}</p></div>`;\n    }\n  }\n  if (results.verification) {\n    reasoning = results.verification.gdeltResults;\n    details += `<p><strong>Verification:</strong> ${results.verification.gdeltResults}</p>`;\n    if (results.context) {\n      details += `<p><strong>Weather Match:</strong> ${results.context.weatherMatch ? \"Yes\" : \"No\"}</p>`;\n    }\n  }\n  if (results.transcription) {\n    facts += `<div><h4 style=\"margin-bottom: 5px;\">Transcription:</h4><p style=\"font-size: 12px; color: #666; font-style: italic;\">\"${results.transcription.slice(0, 200)}${results.transcription.length > 200 ? '...' : ''}\"</p></div>`;\n  }\n\n  let scoreColor = \"#333\";\n  let scoreLabel = \"Unknown\";\n  if (score > 75) { scoreColor = \"#22c55e\"; scoreLabel = \"High Trust\"; }\n  else if (score > 40) { scoreColor = \"#f59e0b\"; scoreLabel = \"Caution\"; }\n  else if (score !== \"N/A\") { scoreColor = \"#ef4444\"; scoreLabel = \"High Risk\"; }\n\n  modalContent.innerHTML = `\n    <div style=\"text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;\">\n      <h3 style=\"margin-top: 0; font-size: 14px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;\">Trust Score</h3>\n      <div style=\"display: flex; align-items: center; justify-content: center; gap: 10px;\">\n        <span style=\"font-size: 48px; font-weight: 800; color: ${scoreColor}; line-height: 1;\">${score}</span>\n        <div style=\"text-align: left;\">\n            <div style=\"font-size: 18px; font-weight: bold; color: ${scoreColor};\">${scoreLabel}</div>\n            <div style=\"font-size: 12px; color: #999;\">out of 100</div>\n        </div>\n      </div>\n    </div>\n    \n    <div style=\"margin-bottom: 15px;\">\n      <h4 style=\"margin-bottom: 5px; font-size: 14px;\">Analysis Summary:</h4>\n      <p style=\"background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 14px; line-height: 1.5; border-left: 4px solid ${scoreColor}; margin-top: 0;\">${reasoning}</p>\n    </div>\n\n    ${facts ? `<div style=\"margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 10px;\">${facts}</div>` : ''}\n    \n    ${details ? `<div style=\"font-size: 13px; color: #666; border-top: 1px solid #eee; padding-top: 10px;\">${details}</div>` : ''}\n  `;\n}\n\n// --- LOGIC ---\n\nfunction createFactCheckButton(postElement, insertBefore = null) {\n  const button = document.createElement(\"button\");\n  button.innerText = \"Fact Check\";\n  button.className = \"unearth-agent-button\"; // Add a class for styling and to avoid re-adding\n  button.style.cssText = `\n    background-color: #386641;\n    color: white;\n    border: none;\n    border-radius: 9999px;\n    padding: 6px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    margin-top: 8px;\n    opacity: 0.8;\n    transition: opacity 0.2s;\n  `;\n  button.onmouseover = () => (button.style.opacity = \"1\");\n  button.onmouseout = () => (button.style.opacity = \"0.8\");\n\n  button.onclick = async (e) => {\n    e.stopPropagation(); // Prevent navigating to the tweet when clicking the button\n    e.preventDefault();\n\n    showLoading();\n    let payload = null;\n\n    // Extract the best content candidate for analysis\n    const analyzed = extractContentFromPost(postElement);\n    if (analyzed && analyzed.type === \"text\") {\n      payload = { type: \"text\", content: analyzed.content };\n    } else if (analyzed && analyzed.type === \"url\") {\n      // If the URL is already a data URI, use it directly\n      if (analyzed.content.startsWith(\"data:\")) {\n        // Detect image/video from the data URI's MIME type\n        if (analyzed.content.startsWith(\"data:image\")) {\n          payload = { type: \"image\", dataUri: analyzed.content };\n        } else if (\n          analyzed.content.startsWith(\"data:video\") ||\n          analyzed.content.startsWith(\"data:audio\")\n        ) {\n          payload = { type: \"video\", dataUri: analyzed.content };\n        } else {\n          // Unknown MIME type: fallback to URL-based analysis\n          payload = { type: \"url\", content: analyzed.content };\n        }\n      } else {\n        // Request the background to fetch and convert to data URI so we can send it for analysis\n        showLoading();\n        console.debug(\n          \"Unearth Agent: requesting fetchMedia for\",\n          analyzed.content\n        );\n        // If this is a blob: URL we can handle it in the page context without background proxy\n        if (analyzed.content.startsWith(\"blob:\")) {\n          fetchBlobUrlAsDataUri(analyzed.content).then((dataUri) => {\n            if (!dataUri) {\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"url\", content: analyzed.content },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n              return;\n            }\n            // Determine if blob is image or video\n            const ct = dataUri.split(\";\")[0];\n            if (ct.includes(\"image\"))\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"image\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            else\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"video\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n          });\n          return;\n        }\n\n        chrome.runtime.sendMessage(\n          { action: \"fetchMedia\", payload: { url: analyzed.content } },\n          (resp) => {\n            if (!resp || !resp.success) {\n              console.warn(\n                \"Unearth Agent: background fetchMedia failed, falling back to URL\",\n                resp && resp.error\n              );\n              // Fallback: send URL directly to the server to try fetching it\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"url\", content: analyzed.content },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n              return;\n            }\n\n            const { dataUri, contentType } = resp;\n            // Choose the correct input type expected by the analysis endpoint\n            if (contentType && contentType.includes(\"image\")) {\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"image\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            } else if (\n              contentType &&\n              (contentType.includes(\"video\") || contentType.includes(\"audio\"))\n            ) {\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"video\", dataUri },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            } else {\n              // Unknown content type; fall back to URL analysis\n              chrome.runtime.sendMessage(\n                {\n                  action: \"analyzeContent\",\n                  payload: { type: \"url\", content: analyzed.content },\n                  origin: window.location.origin,\n                },\n                showResults\n              );\n            }\n          }\n        );\n        // We bail out here because the async response will call showResults or fallback\n        return;\n      }\n    }\n\n    if (payload) {\n      console.debug(\n        \"Unearth Agent: sending analyzeContent payload type\",\n        payload.type\n      );\n      chrome.runtime.sendMessage(\n        { action: \"analyzeContent\", payload, origin: window.location.origin },\n        showResults\n      );\n    } else {\n      showResults({\n        success: false,\n        error:\n          \"Couldn't find analyzable content (text, image, or video) in this post.\",\n      });\n    }\n  };\n\n  // If an insertion point was provided, insert before it, otherwise append to the post\n  if (insertBefore && insertBefore.parentElement) {\n    insertBefore.parentElement.insertBefore(button, insertBefore);\n  } else {\n    postElement.appendChild(button);\n  }\n\n  return button;\n}\n\n// --- Site detection & Post collection helpers ---\nfunction getSiteType() {\n  const h = window.location.hostname;\n  if (h.includes(\"x.com\") || h.includes(\"twitter.com\")) return \"x\";\n  if (h.includes(\"instagram\") || h.includes(\"instagramc\")) return \"instagram\";\n  if (h.includes(\"facebook.com\")) return \"facebook\";\n  if (\n    document.querySelector(\"article\") ||\n    document.querySelector(\"main article\")\n  )\n    return \"article\";\n  return \"other\";\n}\n\nfunction extractContentFromPost(postElement) {\n  try {\n    const video =\n      postElement.querySelector(\"video[src]\") ||\n      postElement.querySelector(\"video\");\n    if (video && video.src) return { type: \"url\", content: video.src };\n    // Find the best image candidate (largest by area) to avoid selecting avatars or emojis\n    const images = postElement.querySelectorAll(\"img[src], img[data-src], img[srcset]\");\n    let bestImage = null;\n    let maxArea = 0;\n\n    images.forEach((img) => {\n      const rect = img.getBoundingClientRect();\n      const area = rect.width * rect.height;\n      // Filter out small images (likely avatars, emojis, or UI icons)\n      // 10,000 px^2 is roughly 100x100\n      if (area > 10000 && area > maxArea) {\n        maxArea = area;\n        bestImage = img;\n      }\n    });\n\n    if (bestImage) {\n      let src =\n        bestImage.getAttribute(\"src\") ||\n        bestImage.getAttribute(\"data-src\") ||\n        bestImage.getAttribute(\"srcset\");\n      if (src && src.includes(\",\")) {\n        const parts = src.split(\",\").map((s) => s.trim());\n        const last = parts[parts.length - 1].split(\" \")[0];\n        src = last;\n      }\n      if (src) return { type: \"url\", content: src };\n    }\n    const text =\n      postElement.querySelector('[data-testid=\"tweetText\"]') ||\n      postElement.querySelector(\"p\") ||\n      postElement.querySelector(\"h1\") ||\n      postElement.querySelector(\"h2\");\n    if (text && text.innerText)\n      return { type: \"text\", content: text.innerText };\n    const combinedText = (postElement.innerText || \"\").trim();\n    if (combinedText.length > 20)\n      return { type: \"text\", content: combinedText.slice(0, 500) };\n    return null;\n  } catch (err) {\n    console.error(\"extractContentFromPost error\", err);\n    return null;\n  }\n}\n\n// Convert an ArrayBuffer to a Base64 data URI with a given MIME type\nfunction arrayBufferToDataUri(\n  arrayBuffer,\n  mimeType = \"application/octet-stream\"\n) {\n  const bytes = new Uint8Array(arrayBuffer);\n  const chunkSize = 0x8000; // large chunk size for performance\n  let binary = \"\";\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    const chunk = bytes.subarray(i, i + chunkSize);\n    binary += String.fromCharCode.apply(null, chunk);\n  }\n  const base64 = btoa(binary);\n  return `data:${mimeType};base64,${base64}`;\n}\n\n// Attempt to fetch a blob URL directly from the page context and convert to a data URI\nasync function fetchBlobUrlAsDataUri(url) {\n  try {\n    const resp = await fetch(url);\n    if (!resp.ok) throw new Error(`Failed to fetch blob url: ${resp.status}`);\n    const contentType =\n      resp.headers.get(\"content-type\") || \"application/octet-stream\";\n    const arrayBuffer = await resp.arrayBuffer();\n    return arrayBufferToDataUri(arrayBuffer, contentType);\n  } catch (err) {\n    console.error(\"fetchBlobUrlAsDataUri error\", err);\n    return null;\n  }\n}\n\nfunction collectPosts() {\n  const site = getSiteType();\n  let nodeList = [];\n  if (site === \"x\")\n    nodeList = document.querySelectorAll('article[data-testid=\"tweet\"]');\n  else if (site === \"instagram\")\n    nodeList = document.querySelectorAll(\"article\");\n  else if (site === \"facebook\")\n    nodeList = document.querySelectorAll('div[role=\"article\"]');\n  else if (site === \"article\") nodeList = document.querySelectorAll(\"article\");\n  else\n    nodeList = document.querySelectorAll(\n      'article, div[role=\"article\"], section'\n    );\n  // Filter to ensure posts that contain analyzable content are prioritized\n  return [...nodeList].filter(\n    (p) =>\n      p &&\n      (p.querySelector(\"img[src]\") ||\n        p.querySelector(\"video\") ||\n        p.querySelector(\"p\") ||\n        p.querySelector(\"h1\") ||\n        p.querySelector(\"h2\"))\n  );\n}\n\nfunction addButtonsToPosts() {\n  const posts = collectPosts();\n  posts.forEach((post) => {\n    if (post.querySelector(\".unearth-agent-button\")) return;\n    // Attempt to find an action bar or footer for the post to place our button\n    const actionBar = post.querySelector(\n      'div[role=\"group\"], footer, section, ._abm0, ._9esb, ._a9zp'\n    );\n    createFactCheckButton(post, actionBar);\n  });\n}\n\n// Run the function initially and then use a MutationObserver to watch for new posts being added to the page\n// This is more efficient than running a setInterval\naddButtonsToPosts();\n\nconst observer = new MutationObserver((mutations) => {\n  for (const mutation of mutations) {\n    if (mutation.addedNodes.length) {\n      addButtonsToPosts();\n      break; // No need to check all mutations if we already found new nodes\n    }\n  }\n});\n\nobserver.observe(document.body, {\n  childList: true,\n  subtree: true,\n});\n\nconsole.log(\"Unearth Agent content script loaded and observing.\");\n"],"names":["modal","document","createElement","id","style","cssText","header","title","textContent","margin","fontSize","closeButton","onclick","display","appendChild","content","overflowY","body","createModal","modalContent","getElementById","showLoading","innerHTML","showResults","data","console","log","success","error","results","score","misScore","misinformationImmunityScore","reasoning","details","facts","formatList","items","map","i","join","urlAnalysis","riskReasoning","sourceReputation","keyClaims","length","textAnalysis","imageAnalysis","manipulationAssessment","description","verification","gdeltResults","context","weatherMatch","transcription","slice","scoreColor","scoreLabel","addButtonsToPosts","site","h","window","location","hostname","includes","querySelector","getSiteType","nodeList","querySelectorAll","filter","p","collectPosts","forEach","post","actionBar","postElement","insertBefore","button","innerText","className","onmouseover","opacity","onmouseout","async","e","stopPropagation","preventDefault","payload","analyzed","video","src","type","images","bestImage","maxArea","img","rect","getBoundingClientRect","area","width","height","getAttribute","parts","split","s","trim","text","combinedText","err","extractContentFromPost","startsWith","debug","url","resp","fetch","ok","Error","status","contentType","headers","get","arrayBuffer","mimeType","bytes","Uint8Array","binary","chunk","subarray","String","fromCharCode","apply","btoa","arrayBufferToDataUri","fetchBlobUrlAsDataUri","then","dataUri","chrome","runtime","sendMessage","action","origin","warn","parentElement","createFactCheckButton","MutationObserver","mutations","mutation","addedNodes","observe","childList","subtree"],"ignoreList":[],"sourceRoot":""}