{"version":3,"file":"content.js","mappings":"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","sources":["webpack://nextn/./src/extension/content.js"],"sourcesContent":["// This script is injected into social media pages.\r\n// It will be responsible for finding posts and adding the \"Fact Check\" button.\r\n\r\n// --- UI & MODAL ---\r\n\r\nfunction createModal() {\r\n  const modal = document.createElement('div');\r\n  modal.id = 'unearth-agent-modal';\r\n  modal.style.cssText = `\r\n    position: fixed;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    z-index: 99999;\r\n    background-color: white;\r\n    border: 1px solid #ccc;\r\n    border-radius: 8px;\r\n    padding: 20px;\r\n    width: 90%;\r\n    max-width: 500px;\r\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\r\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\r\n    color: #333;\r\n    display: none;\r\n    flex-direction: column;\r\n    max-height: 80vh;\r\n  `;\r\n\r\n  const header = document.createElement('div');\r\n  header.style.cssText = `\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    border-bottom: 1px solid #eee;\r\n    padding-bottom: 10px;\r\n    margin-bottom: 15px;\r\n  `;\r\n\r\n  const title = document.createElement('h2');\r\n  title.textContent = 'Unearth Agent Analysis';\r\n  title.style.margin = '0';\r\n  title.style.fontSize = '18px';\r\n\r\n  const closeButton = document.createElement('button');\r\n  closeButton.textContent = 'Ã—';\r\n  closeButton.style.cssText = `\r\n    border: none;\r\n    background: transparent;\r\n    font-size: 24px;\r\n    cursor: pointer;\r\n  `;\r\n  closeButton.onclick = () => (modal.style.display = 'none');\r\n\r\n  header.appendChild(title);\r\n  header.appendChild(closeButton);\r\n\r\n  const content = document.createElement('div');\r\n  content.id = 'unearth-agent-modal-content';\r\n  content.style.overflowY = 'auto';\r\n\r\n  modal.appendChild(header);\r\n  modal.appendChild(content);\r\n\r\n  document.body.appendChild(modal);\r\n  return modal;\r\n}\r\n\r\nconst modal = createModal();\r\nconst modalContent = document.getElementById('unearth-agent-modal-content');\r\n\r\nfunction showLoading() {\r\n  modal.style.display = 'flex';\r\n  modalContent.innerHTML = `<p style=\"text-align: center;\">Analyzing... This may take a moment.</p>`;\r\n}\r\n\r\nfunction showResults(data) {\r\n  if (!data.success) {\r\n    modalContent.innerHTML = `<p style=\"color: red; font-weight: bold;\">Analysis Failed</p><p>${data.error || 'An unknown error occurred.'}</p>`;\r\n    return;\r\n  }\r\n\r\n  const results = data.results;\r\n  const score = results.misScore?.misinformationImmunityScore ?? 'N/A';\r\n  let reasoning = 'No detailed analysis available.';\r\n  if (results.urlAnalysis) reasoning = results.urlAnalysis.riskReasoning;\r\n  if (results.textAnalysis) reasoning = results.textAnalysis.riskReasoning;\r\n  if (results.imageAnalysis) reasoning = results.imageAnalysis.riskReasoning;\r\n  if (results.verification) reasoning = results.verification.gdeltResults;\r\n\r\n  let scoreColor = '#333';\r\n  if (score > 75) scoreColor = '#22c55e'; // green\r\n  else if (score > 40) scoreColor = '#f59e0b'; // amber\r\n  else if (score !== 'N/A') scoreColor = '#ef4444'; // red\r\n  \r\n\r\n  modalContent.innerHTML = `\r\n    <div style=\"text-align: center;\">\r\n      <h3 style=\"margin-top: 0; font-size: 16px; color: #555;\">Misinformation Immunity Score</h3>\r\n      <p style=\"font-size: 48px; font-weight: bold; margin: 10px 0; color: ${scoreColor};\">${score}</p>\r\n    </div>\r\n    <div>\r\n      <h4 style=\"margin-bottom: 5px;\">Analysis Summary:</h4>\r\n      <p style=\"background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 14px; border-left: 3px solid ${scoreColor};\">${reasoning}</p>\r\n    </div>\r\n  `;\r\n}\r\n\r\n// --- LOGIC ---\r\n\r\nfunction createFactCheckButton(postElement) {\r\n  const button = document.createElement('button');\r\n  button.innerText = 'Fact Check';\r\n  button.className = 'unearth-agent-button'; // Add a class for styling and to avoid re-adding\r\n  button.style.cssText = `\r\n    background-color: #386641;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 9999px;\r\n    padding: 6px 12px;\r\n    font-size: 12px;\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    margin-top: 8px;\r\n    opacity: 0.8;\r\n    transition: opacity 0.2s;\r\n  `;\r\n  button.onmouseover = () => (button.style.opacity = '1');\r\n  button.onmouseout = () => (button.style.opacity = '0.8');\r\n\r\n  button.onclick = async (e) => {\r\n    e.stopPropagation(); // Prevent navigating to the tweet when clicking the button\r\n    e.preventDefault();\r\n\r\n    showLoading();\r\n    let payload = null;\r\n\r\n    // Try to find different types of content within the post\r\n    const image = postElement.querySelector('img[alt=\"Image\"]');\r\n    const video = postElement.querySelector('video');\r\n    // Twitter/X specific selector for the main text content\r\n    const postTextElement = postElement.querySelector('[data-testid=\"tweetText\"]'); \r\n\r\n    if (video && video.src) {\r\n        // Can't read video content directly. Best we can do is send the URL.\r\n        // In a real-world scenario, this is a limitation. Our app can handle it if the URL is public.\r\n         payload = { type: 'url', content: video.src };\r\n    } else if (image && image.src) {\r\n        // We can't analyze external images directly due to CORS.\r\n        // We'll treat it as a URL analysis. The backend can fetch it.\r\n        payload = { type: 'url', content: image.src };\r\n    } else if (postTextElement && postTextElement.innerText) {\r\n        payload = { type: 'text', content: postTextElement.innerText };\r\n    }\r\n\r\n    if (payload) {\r\n      chrome.runtime.sendMessage({ action: 'analyzeContent', payload, origin: window.location.origin }, showResults);\r\n    } else {\r\n      showResults({ success: false, error: \"Couldn't find analyzable content (text, image, or video) in this post.\" });\r\n    }\r\n  };\r\n\r\n  return button;\r\n}\r\n\r\n// Function to find and add buttons to posts\r\nfunction addButtonsToPosts() {\r\n  // Use a more specific selector for Twitter/X articles to avoid adding buttons to unrelated elements\r\n  const posts = document.querySelectorAll('article[data-testid=\"tweet\"]');\r\n\r\n  posts.forEach(post => {\r\n    // Check if we've already added a button to this post\r\n    if (post.querySelector('.unearth-agent-button')) {\r\n      return;\r\n    }\r\n\r\n    const button = createFactCheckButton(post);\r\n    \r\n    // Find the action bar (where reply, like, etc. buttons are)\r\n    const actionBar = post.querySelector('div[role=\"group\"]');\r\n    if (actionBar) {\r\n        // Prepend our button to the action bar for better placement\r\n        actionBar.parentElement.appendChild(button);\r\n    } else {\r\n        // Fallback to just appending to the post if the action bar isn't found\r\n        post.appendChild(button);\r\n    }\r\n  });\r\n}\r\n\r\n// Run the function initially and then use a MutationObserver to watch for new posts being added to the page\r\n// This is more efficient than running a setInterval\r\naddButtonsToPosts();\r\n\r\nconst observer = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n        if (mutation.addedNodes.length) {\r\n            addButtonsToPosts();\r\n            break; // No need to check all mutations if we already found new nodes\r\n        }\r\n    }\r\n});\r\n\r\nobserver.observe(document.body, {\r\n  childList: true,\r\n  subtree: true,\r\n});\r\n\r\nconsole.log('Unearth Agent content script loaded and observing.');\r\n"],"names":["modal","document","createElement","id","style","cssText","header","title","textContent","margin","fontSize","closeButton","onclick","display","appendChild","content","overflowY","body","createModal","modalContent","getElementById","showResults","data","success","innerHTML","error","results","score","misScore","misinformationImmunityScore","reasoning","urlAnalysis","riskReasoning","textAnalysis","imageAnalysis","verification","gdeltResults","scoreColor","addButtonsToPosts","querySelectorAll","forEach","post","querySelector","button","postElement","innerText","className","onmouseover","opacity","onmouseout","async","e","stopPropagation","preventDefault","payload","image","video","postTextElement","src","type","chrome","runtime","sendMessage","action","origin","window","location","createFactCheckButton","actionBar","parentElement","MutationObserver","mutations","mutation","addedNodes","length","observe","childList","subtree","console","log"],"ignoreList":[],"sourceRoot":""}