(()=>{const e=function(){const e=document.createElement("div");e.id="unearth-agent-modal",e.style.cssText='\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 99999;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    width: 90%;\n    max-width: 500px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n    color: #333;\n    display: none;\n    flex-direction: column;\n    max-height: 80vh;\n  ';const t=document.createElement("div");t.style.cssText="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n  ";const n=document.createElement("h2");n.textContent="Unearth Agent Analysis",n.style.margin="0",n.style.fontSize="18px";const o=document.createElement("button");o.textContent="√ó",o.style.cssText="\n    border: none;\n    background: transparent;\n    font-size: 24px;\n    cursor: pointer;\n  ",o.onclick=()=>e.style.display="none",t.appendChild(n),t.appendChild(o);const i=document.createElement("div");return i.id="unearth-agent-modal-content",i.style.overflowY="auto",e.appendChild(t),e.appendChild(i),document.body.appendChild(e),e}(),t=document.getElementById("unearth-agent-modal-content");function n(){e.style.display="flex",t.innerHTML='<p style="text-align: center;">Analyzing... This may take a moment.</p>'}function o(e){if(console.log("Unearth Agent: showResults",e),!e.success)return void(t.innerHTML=`<p style="color: red; font-weight: bold;">Analysis Failed</p><p>${e.error||"An unknown error occurred."}</p>\n    <p style="font-size: 10px; color: #999; margin-top: 10px;">Check the extension console or server logs for more details.</p>`);const n=e.results,o=n.misScore?.misinformationImmunityScore??"N/A";let i="No detailed analysis available.",r="",a="";const s=e=>e.map(e=>`<li>${e}</li>`).join("");n.urlAnalysis&&(i=n.urlAnalysis.riskReasoning,r+=`<p><strong>Source Reputation:</strong> ${n.urlAnalysis.sourceReputation}</p>`,n.urlAnalysis.keyClaims?.length&&(a=`<div><h4 style="margin-bottom: 5px;">Key Claims:</h4><ul style="padding-left: 20px; margin-top: 0;">${s(n.urlAnalysis.keyClaims)}</ul></div>`)),n.textAnalysis&&(i=n.textAnalysis.riskReasoning,n.textAnalysis.keyClaims?.length&&(a=`<div><h4 style="margin-bottom: 5px;">Key Claims:</h4><ul style="padding-left: 20px; margin-top: 0;">${s(n.textAnalysis.keyClaims)}</ul></div>`)),n.imageAnalysis&&(i=n.imageAnalysis.riskReasoning,r+=`<p><strong>Manipulation:</strong> ${n.imageAnalysis.manipulationAssessment}</p>`,n.imageAnalysis.description&&(a=`<div><h4 style="margin-bottom: 5px;">Content Description:</h4><p style="font-size: 13px; color: #555;">${n.imageAnalysis.description}</p></div>`)),n.verification&&(i=n.verification.gdeltResults,r+=`<p><strong>Verification:</strong> ${n.verification.gdeltResults}</p>`,n.context&&(r+=`<p><strong>Weather Match:</strong> ${n.context.weatherMatch?"Yes":"No"}</p>`)),n.transcription&&(a+=`<div><h4 style="margin-bottom: 5px;">Transcription:</h4><p style="font-size: 12px; color: #666; font-style: italic;">"${n.transcription.slice(0,200)}${n.transcription.length>200?"...":""}"</p></div>`);let l="#333",c="Unknown";o>75?(l="#22c55e",c="High Trust"):o>40?(l="#f59e0b",c="Caution"):"N/A"!==o&&(l="#ef4444",c="High Risk"),t.innerHTML=`\n    <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;">\n      <h3 style="margin-top: 0; font-size: 14px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;">Trust Score</h3>\n      <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">\n        <span style="font-size: 48px; font-weight: 800; color: ${l}; line-height: 1;">${o}</span>\n        <div style="text-align: left;">\n            <div style="font-size: 18px; font-weight: bold; color: ${l};">${c}</div>\n            <div style="font-size: 12px; color: #999;">out of 100</div>\n        </div>\n      </div>\n    </div>\n    \n    <div style="margin-bottom: 15px;">\n      <h4 style="margin-bottom: 5px; font-size: 14px;">Analysis Summary:</h4>\n      <p style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 14px; line-height: 1.5; border-left: 4px solid ${l}; margin-top: 0;">${i}</p>\n    </div>\n\n    ${a?`<div style="margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 10px;">${a}</div>`:""}\n    \n    ${r?`<div style="font-size: 13px; color: #666; border-top: 1px solid #eee; padding-top: 10px; margin-bottom: 15px;">${r}</div>`:""}\n\n    <div style="border-top: 1px solid #eee; padding-top: 15px;">\n        ${n.aiDetection?`\n        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">\n            <div style="display: flex; justify-content: space-between; align-items: center;">\n                <h4 style="margin: 0; font-size: 12px; color: #666; text-transform: uppercase;">ü§ñ AI Probability</h4>\n                <span style="font-weight: 800; color: ${n.aiDetection.aiProbability>50?"#7e22ce":"#15803d"}; font-size: 14px;">\n                    ${n.aiDetection.aiProbability}%\n                </span>\n            </div>\n            <p style="font-size: 11px; color: #666; margin-top: 5px; line-height: 1.4;">${n.aiDetection.reasoning.slice(0,100)}...</p>\n        </div>\n        `:""}\n\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n             <h4 style="margin: 0; font-size: 12px; color: #666; text-transform: uppercase;">Was this helpful?</h4>\n             <div style="display: flex; gap: 8px;">\n                 <button id="unearth-vote-up" style="background: white; border: 1px solid #ddd; border-radius: 4px; padding: 4px 8px; cursor: pointer;">üëç</button>\n                 <button id="unearth-vote-down" style="background: white; border: 1px solid #ddd; border-radius: 4px; padding: 4px 8px; cursor: pointer;">üëé</button>\n             </div>\n        </div>\n\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n            <h4 style="margin: 0; font-size: 12px; color: #666; text-transform: uppercase;">Language</h4>\n            <select id="unearth-lang-select" style="font-size: 12px; padding: 2px 5px; border-radius: 4px; border: 1px solid #ccc;">\n                <option value="English">English</option>\n                <option value="Hindi">Hindi</option>\n                <option value="Marathi">Marathi</option>\n                <option value="Spanish">Spanish</option>\n            </select>\n        </div>\n        <div id="unearth-translated-summary" style="display: none; background: #eef2ff; padding: 10px; border-radius: 4px; font-size: 13px; color: #333; margin-bottom: 10px;"></div>\n\n        <h4 style="margin: 0 0 10px 0; font-size: 12px; color: #666; text-transform: uppercase;">Share Verified Report</h4>\n        <div style="display: flex; gap: 8px;">\n            <button id="unearth-share-x" style="flex: 1; background: #000; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">Share on X</button>\n            <button id="unearth-share-fb" style="flex: 1; background: #1877F2; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500;">Facebook</button>\n        </div>\n        <div style="margin-top: 8px;">\n             <button id="unearth-copy-link" style="width: 100%; background: #f0f0f0; color: #333; border: 1px solid #ccc; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Copy Report Link</button>\n        </div>\n    </div>\n  `,setTimeout(()=>{const e=n.generatedCaption||`Verified by Unearth. MIS Score: ${o}/100`,t=n.reportUrl||"https://unearth.ai",r=n.reportId,a=encodeURIComponent(e),s=encodeURIComponent(t);document.getElementById("unearth-share-x").onclick=()=>{window.open(`https://twitter.com/intent/tweet?text=${a}&url=${s}`,"_blank")},document.getElementById("unearth-share-fb").onclick=()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${s}&quote=${a}`,"_blank")},document.getElementById("unearth-copy-link").onclick=()=>{navigator.clipboard.writeText(`${e} ${t}`).then(()=>{const e=document.getElementById("unearth-copy-link");e.innerText="Copied!",setTimeout(()=>e.innerText="Copy Report Link",2e3)})};const l=e=>{r&&chrome.runtime.sendMessage({action:"vote",payload:{reportId:r,vote:e}},t=>{if(t&&t.success){const t=document.getElementById("up"===e?"unearth-vote-up":"unearth-vote-down");t.style.background="up"===e?"#dcfce7":"#fee2e2",t.style.borderColor="up"===e?"#22c55e":"#ef4444"}})};document.getElementById("unearth-vote-up").onclick=()=>l("up"),document.getElementById("unearth-vote-down").onclick=()=>l("down");const c=document.getElementById("unearth-lang-select"),d=document.getElementById("unearth-translated-summary");c.onchange=async e=>{const t=e.target.value;"English"!==t?(d.style.display="block",d.innerText="Translating...",chrome.runtime.sendMessage({action:"translate",payload:{summary:i,targetLanguage:t}},e=>{e&&e.success?d.innerText=e.translatedSummary:d.innerText="Translation failed. Please try on the website."})):d.style.display="none"}},100)}function i(){(function(){const e=function(){const e=window.location.hostname;return e.includes("x.com")||e.includes("twitter.com")?"x":e.includes("instagram")||e.includes("instagramc")?"instagram":e.includes("facebook.com")?"facebook":document.querySelector("article")||document.querySelector("main article")?"article":"other"}();let t=[];return t="x"===e?document.querySelectorAll('article[data-testid="tweet"]'):"instagram"===e?document.querySelectorAll("article"):"facebook"===e?document.querySelectorAll('div[role="article"]'):"article"===e?document.querySelectorAll("article"):document.querySelectorAll('article, div[role="article"], section'),[...t].filter(e=>e&&(e.querySelector("img[src]")||e.querySelector("video")||e.querySelector("p")||e.querySelector("h1")||e.querySelector("h2")))})().forEach(e=>{if(e.querySelector(".unearth-agent-button"))return;const t=e.querySelector('div[role="group"], footer, section, ._abm0, ._9esb, ._a9zp');!function(e,t=null){const i=document.createElement("button");i.innerText="Fact Check",i.className="unearth-agent-button",i.style.cssText="\n    background-color: #386641;\n    color: white;\n    border: none;\n    border-radius: 9999px;\n    padding: 6px 12px;\n    font-size: 12px;\n    font-weight: 500;\n    cursor: pointer;\n    margin-top: 8px;\n    opacity: 0.8;\n    transition: opacity 0.2s;\n  ",i.onmouseover=()=>i.style.opacity="1",i.onmouseout=()=>i.style.opacity="0.8",i.onclick=async t=>{t.stopPropagation(),t.preventDefault(),n();let i=null;const r=function(e){try{const t=e.querySelector("video[src]")||e.querySelector("video");if(t&&t.src)return{type:"url",content:t.src,element:t};const n=e.querySelectorAll("img[src], img[data-src], img[srcset]");let o=null,i=0;if(n.forEach(e=>{const t=e.getBoundingClientRect(),n=t.width*t.height;n>1e4&&n>i&&(i=n,o=e)}),o){let e=o.getAttribute("src")||o.getAttribute("data-src")||o.getAttribute("srcset");if(e&&e.includes(",")){const t=e.split(",").map(e=>e.trim());e=t[t.length-1].split(" ")[0]}if(e)return{type:"url",content:e,element:o}}const r=e.querySelector('[data-testid="tweetText"]')||e.querySelector("p")||e.querySelector("h1")||e.querySelector("h2");if(r&&r.innerText)return{type:"text",content:r.innerText};const a=(e.innerText||"").trim();return a.length>20?{type:"text",content:a.slice(0,500)}:null}catch(e){return console.error("extractContentFromPost error",e),null}}(e);if(r&&"text"===r.type)i={type:"text",content:r.content};else if(r&&"url"===r.type){if(!r.content.startsWith("data:")){if(n(),console.debug("Unearth Agent: requesting fetchMedia for",r.content),r.content.startsWith("blob:")){console.log("Unearth Agent: Detected blob URL, attempting conversion:",r.content);const e=()=>{if(console.log("Unearth Agent: Fetch failed, attempting frame capture fallback."),r.element&&"VIDEO"===r.element.tagName){const e=function(e){try{const t=document.createElement("canvas");return t.width=e.videoWidth||640,t.height=e.videoHeight||360,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/jpeg")}catch(e){return console.error("Unearth Agent: Failed to capture video frame",e),null}}(r.element);if(e)return console.log("Unearth Agent: Frame capture successful, sending as image."),void chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"image",dataUri:e},origin:window.location.origin},o)}chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"url",content:r.content},origin:window.location.origin},o)};return void async function(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch blob url: ${t.status}`);const n=t.headers.get("content-type")||"application/octet-stream";return function(e,t="application/octet-stream"){const n=new Uint8Array(e);let o="";for(let e=0;e<n.length;e+=32768){const t=n.subarray(e,e+32768);o+=String.fromCharCode.apply(null,t)}return`data:${t};base64,${btoa(o)}`}(await t.arrayBuffer(),n)}catch(e){return console.error("fetchBlobUrlAsDataUri error",e),null}}(r.content).then(t=>{if(!t)return void e();let n="video";t.split(";")[0].includes("image")&&(n="image"),console.log("Unearth Agent: Converted blob to data URI. Type:",n),chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:n,dataUri:t},origin:window.location.origin},o)}).catch(()=>e())}return void chrome.runtime.sendMessage({action:"fetchMedia",payload:{url:r.content}},e=>{if(!e||!e.success)return console.warn("Unearth Agent: background fetchMedia failed, falling back to URL",e&&e.error),void chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"url",content:r.content},origin:window.location.origin},o);const{dataUri:t,contentType:n}=e;n&&n.includes("image")?chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"image",dataUri:t},origin:window.location.origin},o):n&&(n.includes("video")||n.includes("audio"))?chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"video",dataUri:t},origin:window.location.origin},o):chrome.runtime.sendMessage({action:"analyzeContent",payload:{type:"url",content:r.content},origin:window.location.origin},o)})}i=r.content.startsWith("data:image")?{type:"image",dataUri:r.content}:r.content.startsWith("data:video")||r.content.startsWith("data:audio")?{type:"video",dataUri:r.content}:{type:"url",content:r.content}}i?(console.debug("Unearth Agent: sending analyzeContent payload type",i.type),chrome.runtime.sendMessage({action:"analyzeContent",payload:i,origin:window.location.origin},o)):o({success:!1,error:"Couldn't find analyzable content (text, image, or video) in this post."})},t&&t.parentElement?t.parentElement.insertBefore(i,t):e.appendChild(i)}(e,t)})}i(),new MutationObserver(e=>{for(const t of e)if(t.addedNodes.length){i();break}}).observe(document.body,{childList:!0,subtree:!0}),console.log("Unearth Agent content script loaded and observing.")})();
//# sourceMappingURL=content.js.map